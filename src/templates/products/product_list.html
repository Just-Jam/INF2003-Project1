<!-- templates/products/product_list.html -->
{% extends 'base.html' %}

{% block title %}Products - E-Shop{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="mb-0">Products</h2>
  <form class="d-flex" method="get">
    <input
      class="form-control me-2"
      type="search"
      placeholder="Search products..."
      name="q"
      value="{{ request.GET.q }}"
    >
    <button class="btn btn-outline-primary" type="submit">Search</button>
  </form>
</div>

<!-- Example of basic filters -->
<div class="row mb-3">
  <div class="col-md-3">
    <select class="form-select" name="category" form="">
      <option value="">All Categories</option>
      {% for category in categories %}
        <option value="{{ category.id }}" {% if category.id|stringformat:'s' == request.GET.category %}selected{% endif %}>
          {{ category.name }}
        </option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-3">
    <select class="form-select" name="sort" form="">
      <option value="">Sort by</option>
      <option value="price_asc">Price: Low to High</option>
      <option value="price_desc">Price: High to Low</option>
      <option value="newest">Newest</option>
    </select>
  </div>
</div>

{% if products %}
  <div class="row g-3">
    {% for product in products %}
      <div class="col-6 col-md-4 col-lg-3">
        <div class="card h-100 shadow-sm">
          <img
            src="{{ product.image_url|default:'/static/img/placeholder.png' }}"
            class="card-img-top"
            alt="{{ product.name }}"
            style="object-fit: cover; height: 180px;"
          >
          <div class="card-body d-flex flex-column">
            <h6 class="card-title">{{ product.name }}</h6>
            <p class="card-text text-muted mb-1">
              ${{ product.price }}
            </p>
            <p class="card-text small text-truncate">
              {{ product.short_description|default:product.description|truncatechars:60 }}
            </p>
            <div class="mt-auto d-flex justify-content-between">
              <a href="{% url 'product_detail' product.id %}" class="btn btn-sm btn-outline-secondary">
                Details
              </a>
              <form method="post" action="{% url 'add_to_cart' product.id %}">
              <!--<form method="post" action="#">-->
                {% csrf_token %}
                <button type="submit" class="btn btn-sm btn-primary">
                  Add to Cart
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <div class="alert alert-info mt-3">
    No products found.
  </div>
{% endif %}
{% endblock %}
