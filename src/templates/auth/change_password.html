{% extends 'base.html' %}
{% block title %}Change password{% endblock %}
{% block content %}
<h2>Change Password</h2>
<form id="pwForm">
  <div class="mb-3">
    <label>Old password</label>
    <input type="password" class="form-control" name="old_password" required>
  </div>
  <div class="mb-3">
    <label>New password</label>
    <input type="password" class="form-control" name="new_password" required minlength="8">
  </div>
  <div class="mb-3">
    <label>Confirm new password</label>
    <input type="password" class="form-control" name="new_password_confirm" required minlength="8">
  </div>
  <button class="btn btn-primary">Change</button>
  <div id="error" class="text-danger mt-2"></div>
</form>

<script>
document.getElementById('pwForm').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const data = Object.fromEntries(new FormData(e.target).entries());
  try{
    const resp = await auth.changePassword(data);
    alert('Password changed â€“ you may need to log in again');
    location.href = '/profile/';
  }catch(err){
    const message = err.new_password || err.new_password_confirm || err.detail || JSON.stringify(err);
    document.getElementById('error').innerText = Array.isArray(message) ? message[0] : message;
  }
});
</script>
{% endblock %}
