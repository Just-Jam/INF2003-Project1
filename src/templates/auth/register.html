{% extends 'base.html' %}
{% block title %}Register{% endblock %}
{% block content %}
<h2>Register</h2>
<form id="regForm">
  <div class="mb-3">
    <label>Username</label>
    <input class="form-control" name="username" required>
  </div>
  <div class="mb-3">
    <label>Email</label>
    <input type="email" class="form-control" name="email" required>
  </div>
  <div class="mb-3">
    <label>First name</label>
    <input class="form-control" name="first_name">
  </div>
  <div class="mb-3">
    <label>Last name</label>
    <input class="form-control" name="last_name">
  </div>
  <div class="mb-3">
    <label>Password</label>
    <input type="password" class="form-control" name="password" required>
  </div>
  <button class="btn btn-primary">Create account</button>
  <div id="error" class="text-danger mt-2"></div>
</form>

<script>
document.getElementById('regForm').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const form = e.target;
  const data = Object.fromEntries(new FormData(form).entries());
  try{
    // use the namespaced API URL
    await apiCall('{% url "api:register" %}', 'POST', data);
    localStorage.setItem('token', resp.token);
    location.href = "{% url 'profile' %}";
  }catch(err){
    document.getElementById('error').innerText = err.detail || JSON.stringify(err);
  }
});
</script>
{% endblock %}